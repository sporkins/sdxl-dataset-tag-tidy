{% extends "base.html" %}
{% block title %}Pick Dataset{% endblock %}
{% block content %}
<section class="stack">
    <div class="card stack">
        <p>Select a dataset folder under <code>{{ dataset_root or 'configure a dataset root first' }}</code>. Tap through the folder browser to pick a directory, then load it into memory.</p>
        <div class="small">Max 200 images per dataset. Paths are validated server-side.</div>
        {% if error_message %}
        <div class="badge warn">{{ error_message }}</div>
        {% endif %}
    </div>

    {% if not dataset_root %}
    <div class="card stack">
        <p>Set your dataset root path (for example <code>C:/Zen/dev/kohya_ss/training</code>). The value is stored locally in <code>config/config.json</code> and ignored by git.</p>
        <form class="stack" hx-post="/api/config/dataset-root" hx-target="#dataset-root-status" hx-swap="innerHTML" hx-on::after-request="if(event.detail.successful){ window.location.reload(); }">
            <label for="dataset-root-input">Dataset root</label>
            <input id="dataset-root-input" type="text" name="dataset_root" placeholder="C:/Zen/dev/kohya_ss/training" required>
            <button type="submit">Save dataset root</button>
        </form>
        <div id="dataset-root-status" class="small"></div>
    </div>
    {% endif %}

    {% if dataset_root %}
    <input type="hidden" id="selected-rel" name="rel" value="{{ dataset_rel or browse.current.rel }}" data-root-label="{{ dataset_root_label }}">
    <div id="folder-browser">
        {% include "fragments/picker_browser.html" %}
    </div>
    <div class="card stack">
        <div class="small">Selected folder</div>
        <div id="selected-path-label">{{ dataset_rel or browse.current.rel or dataset_root_label }}</div>
        <form class="stack" hx-post="/api/dataset/load" hx-target="#load-result" hx-include="#selected-rel" hx-on::after-request="if(event.detail.successful){ window.location='/dataset'; }">
            <button type="submit">Load dataset</button>
        </form>
        <div id="load-result" class="small"></div>
    </div>
    {% endif %}
</section>
{% endblock %}
